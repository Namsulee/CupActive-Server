<!DOCTYPE html>
<html lang="en" class="bg-color">
<head>
  <meta charset="UTF-8">
  <title>SoolSang Web UI</title>
 
<style >
@import("./www-static/noto-sans-korean-webfont/css/noto-sans-korean.css");
* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

body {
  font-family: "Noto Sans Korean", sans-serif;
  font-weight: 300;
  color: #494949;
  padding: 100px 0px;
  vertical-align:center;
}


nav {
  z-index: 9;
  font-size: 25px;
  color: white;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  padding: 10px 0px;
  text-align: center;

}

.bg-color {
  background-color: #1780E0;
  transition-duration: .5s;
}

footer {
  padding: 40px 0;
  text-align: center;
  opacity: .77;
  color: white;
  font-size:15px;
  font-weight:400;
}

.wrapper {
  max-width: 100%;
  margin: 10px auto;
}

.tabs {
  font-size: 20px;
  line-height: 25px;
  background-color: #FFFFFF;
  vertical-align:middle;
  display: table;

  table-layout: fixed;
  width: 100%;
  -webkit-transform: translateY(5px);
  transform: translateY(5px);
  text-align:center;

}

.tabs > li {
  transition-duration: .25s;
  display: table-cell;
  list-style: none;
  text-align: center;
  vertical-align:middle;
  padding: 30px 40px 10px 40px;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  color: black;
  white-space: nowrap;
}

.tabs > li.active {
  color: #494949;
  content:"";
  font-weight: 900;
  display:block;
  margin: 20px 0px;
  border-bottom: 2px solid #1780E0;
  
}

.tabs > li.active:before {
  transition-duration: .5s;
  background-color: white;
  -webkit-transform: translateY(0);
  transform: translateY(0);
}

.tab__content {
  background-color: white;
  position: relative;
  width: 100%;
}
.tab__content > li {
  width: 100%;
  position: absolute;
  top: 0;
  left: 0;
  display: none;
  list-style: none;
}
.tab__content > li .content__wrapper {
  text-align: center;
  width: 100%;
  padding:40px 40px;
  background-color: white;
  display:relative;
}

.attend h2 {
  width: 100%;
  margin:0 auto;
  text-align: center;
  font-weight: 300;
  font-size:25px;
  position:relative;
  padding-bottom:20px;
}
.gameicon img {
  width: 150px;
  height: auto;
  padding-bottom:20px;
  position:relative;
}

.randombutton {
  background: #2EAFA3;
  border:0;
  border-radius:30px;
  color:white;
  text-align: center;
  position:relative;
  font-size:20px;
  width:200px;
  height:55px;
}

.randombutton:active {
  background-color: #a5e5df;
}

.lovebutton {
  background: #C11F61;
  border:0;
  border-radius:30px;
  color:white;
  text-align: center;
  position:relative;
  font-size:20px;
  margin:15px auto;
  width:200px;
  height:55px;
}

.lovebutton:active {
  background-color: #f7b7d1;
}

.colors-name {
  text-align: center;
}
.colors-name > li {
  list-style: none;
  display: inline-block;
  margin: 0 30px;
}

.colors {
  text-align: center;
  font-size:0.6em;
}

.jb-th-1 {
    width: 200px;
}
.jb-th-2 {
    width: 300px;
}
.jb-th-3 {
    width: 400px;
}
.mytable {
  margin-left: auto; 
  margin-right: auto;
  border-collapse: collapse;
  border: 3px solid #e2e2e2;
}

.mytable th {
  font-size:19px;
  font-weight:300;
  background-color: #e2e2e2;
  color:#1780E0;
  padding:15px;
  margin-left: auto; margin-right: auto;
  border:3px #e2e2e2;
}
.mytable td {
  font-size:18px;
  text-align:center;
  color:#494949;
  padding:10px;
  margin-bottom:20px;
  border: 3px solid #e2e2e2;
}

select {
  width:100px;
  height:30px;
  padding-left:10px;
  font-size:18px;
  color:#494949;
  border:1px solid #1780E0;
  border-radius:3px;
}
.settingbutton {
  background: #1780E0;
  border:0;
  width:200px;
  height:55px;
  border-radius:30px;
  color:white;
  
  position:relative;
  font-size:20px;
  font-weight:100;
  text-align:relative;
  text-align: center;
  text-decoration:none;
  display:inline-block;
  font-size:18px;
  outline:none;
  margin-top:50px;
  margin-left:50px;
  margin-right:50px;
}

.settingbutton:active {
  background-color: #7fbcf4;
}

</style>
<script>
  window.console = window.console || function(t) {};
</script>
  
<script>
  if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
</script>


</head>
<body>
<nav class="bg-color"></br>JOYFUL SOOLSANG</nav>
<section class="wrapper">
    <ul class="tabs">
        <li><p>RANDOM GAME</li>
        <li><p>LOVE SHOT GAME</li>
        <li class="active"><p>SETTINGS</p></li>
    </ul>

    <ul class="tab__content">
        <li>
            <div class="content__wrapper">
                <div class="gameicon">
                  <img id=rg_img src="images/icon_rg_nor.png" />
                </div>
                <div class="attend">
                  <h2 id=rg_text>XX 명 게임 참여 중</h2>
                </div>
                <div>
                  <button class="randombutton" id="rg_game_bt">READY</button>
                </div>
            </div>
        </li>
        <li>
            <div class="content__wrapper">
                <div class="gameicon">
                  <img id=lg_img src="images/icon_lg_nor.png" />
                </div>
                <div class="attend">
                  <h2 id=lg_text>XX 명 게임 참여 중</h2>
                </div>
                <div>
                  <button class="lovebutton" id="lg_game_bt">READY</button>
                </div>
            </div>
        </li>        
        <li class="active">
            <div class="content__wrapper" >
                <div class="cups" onLoad="pagestart()">
                </div>
                <div>
                  <button class="settingbutton" id="send">REGISTER</button>
                  <button class="settingbutton" id="restart">RESET ALL</button>
                </div>
            </div>
        </li>
        
    </ul>
    <footer class="footer">Created by SOOLDONGMOO</footer>
</section>
  <script src="./codepen.js"></script>
  <script src='./jquery-3.3.1.min.js'></script>
  <script>
    reload();

    function autoRefresh_sample_div()
    {
      clickedTab = $(".tabs .active");
      var clickedTabIndex = clickedTab.index();
      if (clickedTabIndex == 2) {
      var currentLocation = window.location;
        console.log("setting");
        $(".tabs > .active").css("border-bottom-color", "#1780E0");
        reload();
      }
    }
    setInterval('autoRefresh_sample_div()', 5000); 
    $(document).ready(function () {
        // Variables
        var clickedTab = $(".tabs > .active");
        var tabWrapper = $(".tab__content");
        var activeTab = tabWrapper.find(".active");
        // Show tab on page load
        var activeTabHeight = activeTab.outerHeight();
        // Set height of wrapper on page load
        tabWrapper.height(activeTabHeight);
        activeTab.show();

        $(".tabs > li").on("click", function () {
            // Remove class from active tab
            $(".tabs > li").removeClass("active");
            $(".colors > li").removeClass("active-color");
            $(".bg-color").css("background-color", "#1780E0");

            // Add class active to clicked tab
            $(this).addClass("active");

            // Update clickedTab variable
            clickedTab = $(".tabs .active");

            // fade out active tab
            activeTab.fadeOut(250, function () {
                // Remove active class all tabs
                $(".tab__content > li").removeClass("active");

                // Get index of clicked tab
                var clickedTabIndex = clickedTab.index();
                // Add class active to corresponding tab
                $(".tab__content > li").eq(clickedTabIndex).addClass("active");

                // update new active tab
                activeTab = $(".tab__content > .active");
                console.log(activeTab);
                // Update variable
                activeTabHeight = activeTab.outerHeight();

                // Animate height of wrapper to new tab height
                tabWrapper.stop().delay(50).animate({
                    height: activeTabHeight },
                    500, function () {
                    // Fade in active tab
                    activeTab.delay(50).fadeIn(250);

                });

                if (clickedTabIndex == 0) { // random game
                  console.log("random");
                  checkCups("#rg_text");
                  $(".bg-color").css("background-color", "#2EAFA3");
                  $(".gamebutton").css("background", "#2EAFA3");
                  $('#rg_img').attr("src","images/icon_rg_nor.png");
                  $(".tabs > .active").css("border-bottom-color", "#2EAFA3");

                } else if (clickedTabIndex == 1) { // love shot game
                  console.log("lovshot");
                  checkCups("#lg_text");
                  $(".bg-color").css("background-color", "#C11F61");
                  $(".gamebutton").css("background", "#C11F61");
                  $('#lg_img').attr("src","images/icon_lg_nor.png");
                  $(".tabs > .active").css("border-bottom-color", "#C11F61");
                } else if (clickedTabIndex == 2) { // setting
                  console.log("setting");

                  $(".tabs > .active").css("border-bottom-color", "#1780E0");
                  reload();
                }

            });
        });
    });
    
    function reload() {
      var filePath = "cups.json"
      var result = null;
      var jsonobj = null;
      var xmlhttp = new XMLHttpRequest();

      console.log("cups.json path : " + filePath);

      xmlhttp.onreadystatechange = function() {
        console.log("xmlhttp.status =" + this.status);
        if (this.readyState == 4 && this.status == 200) {
          console.log("xmlhttp.responseText =" + this.responseText);
          result = xmlhttp.responseText;
          jsonobj = JSON.parse(result);

          display(jsonobj);
          console.log("reload completed~~~");
        }
      };
      xmlhttp.open("GET", filePath, true);
      xmlhttp.send();
    }

    function checkCups(tabs) {
      var cnt = 0;
      var filePath = "cups.json"
      var result = null;
      var jsonobj = null;
      var xmlhttp = new XMLHttpRequest();

      xmlhttp.onreadystatechange = function() {
        console.log("xmlhttp.status =" + this.status);
        if (this.readyState == 4 && this.status == 200) {
          console.log("xmlhttp.responseText =" + this.responseText);
          result = xmlhttp.responseText;
          jsonobj = JSON.parse(result);

          for (j in jsonobj.Lists) {
            cnt++;
          }
          console.log("cup is" + cnt);
          var inputString = cnt + "명 게임 참여 중";
          $(tabs).text(inputString);
           $('#rg_text').text(inputString);
        }
      };

      xmlhttp.open("GET", filePath, true);
      xmlhttp.send();
    }

    function test() {
      alert("test");
    }

    function readTextFile(file, callback) {
      var rawFile = new XMLHttpRequest();
      rawFile.overrideMimeType("application/json");
      rawFile.open("GET", file, true);
      rawFile.onreadystatechange = function() {
          if (rawFile.readyState === 4 && rawFile.status == "200") {
              callback(rawFile.responseText);
          }
      }
      rawFile.send(null);
    }

    function display(jsonobj) {
      var outstring;

      console.log("reload cup lists~~~");

      outstring = "<div class=cups><table class=mytable>";
      outstring += "<tr><th class=jb-th-1>ID</th><th class=jb-th-2>IP</th><th class=jb-th-3>How much can you drink?</th>"

      for (j in jsonobj.Lists) {
          outstring += "<tr>";
          outstring += "<td style='color:#1780E0'>" + jsonobj.Lists[j].Name + "</td>";
          outstring += "<td>" + jsonobj.Lists[j].IPAddress + "</td>";
          outstring += "<td><select name='number' id=number" + j + "><option>1</option><option>2</option><option>3</option><option>4</option><option selected='selected'>5</option><option>6</option><option>7</option><option>8</option><option>9</option></select></td>";
          outstring += "</tr>"
      }
      outstring += "</table></div>"
 
      $('.cups').html(outstring);
    }

    function sleep(delay) {
      var start = new Date().getTime();
      while (new Date().getTime() < start + delay);
    }

    window.addEventListener("load", function(evt) {
      var conn;

      conn = new WebSocket("ws://" + document.location.host + "/ws");
      conn.onclose = function (evt) {
          console.log("Close websocket");
      };
      conn.onmessage = function (evt) {
          var messages = evt.data.split('\n');
          for (var i = 0; i < messages.length; i++) {
              var item = document.createElement("div");
              item.innerText = messages[i];
              appendLog(item);
          }
      };

      document.getElementById("send").onclick = function(evt) {
          if (!conn) {
            return false;
          }
          // json create and send through ws
          var obj = new Object();
          obj.cmd = "usersetting";
          //usage:
          readTextFile("cups.json", function(text){
              var data = JSON.parse(text);
              console.log(data);
              var cap = [];

              for (j in data.Lists) {
                var id = "number" + j;
                console.log(id);
                cap.push(Number(document.getElementById(id).value));
              }

              obj.cap = cap;
              console.log(obj);
              var jsonString = JSON.stringify(obj);

              conn.send(jsonString);
          });

          
          return false;
      };

      document.getElementById("restart").onclick = function(evt) {
          if (!conn) {
            return false;
          }

          var obj = new Object();
          obj.cmd = "restart";
          var jsonString = JSON.stringify(obj);

          conn.send(jsonString);

          return false;
      };

      document.getElementById("rg_game_bt").onclick = function(evt) {
        console.log("randombutton");
        if (!conn) {
          return false;
        }
        var name = $('#rg_game_bt').text();
        console.log(name);

        var obj = new Object();
        obj.cmd = "gamesetting";
        clickedGame = $(".colors .active-color");
        obj.kind = 1; //random game
        
        if (name == "READY") {
          obj.state = 0; // ready
          $('#rg_game_bt').text("START");
          $('#rg_img').attr("src","images/icon_rg_ready.png");
          readTextFile("cups.json", function(text){
            var data = JSON.parse(text);
            console.log(data);
            console.log("length :" + data.Lists.length);
            // select random cup to send
            var jsonString = JSON.stringify(obj);
            conn.send(jsonString);
          });
        } else if (name == "START") {
          obj.state = 1; // ready
          $('#rg_game_bt').text("SELETING...");
          $('#rg_game_bt').css("font-size", 30);
          $('#rg_game_bt').css("color", "#2EAFA3");
          
          $('#rg_img').attr("src","images/icon_rg_done.png");
          $('#rg_game_bt').attr("disabled",true);
          $(".randombutton").css("background-color", "rgba( 255, 255, 255, 0.5 )");
        
          readTextFile("cups.json", function(text){
            var data = JSON.parse(text);
            console.log(data);
            console.log("length :" + data.Lists.length);
            // select random cup to send
            var jsonString = JSON.stringify(obj);
            conn.send(jsonString);
          });
  
          setTimeout(function() {
            $('#rg_game_bt').text("READY");
            $('#rg_img').attr("src","images/icon_rg_nor.png");
            $('#rg_game_bt').attr("disabled",false);
            $(".randombutton").css("background-color", "#2EAFA3");
            $('#rg_game_bt').css("color", "#FFFFFF");
            $('#rg_game_bt').css("font-size", 20);
            
          }, 5000);
        }
      };

      document.getElementById("lg_game_bt").onclick = function(evt) {
        console.log("loveshotbutton");
        if (!conn) {
          return false;
        }
        var name = $('#lg_game_bt').text();
        console.log(name);

        var obj = new Object();
        obj.cmd = "gamesetting";
        clickedGame = $(".colors .active-color");
        obj.kind = 2; //loveshot game
        
        if (name == "READY") {
          obj.state = 0 // ready
          $('#lg_game_bt').text("START");
          $('#lg_img').attr("src","images/icon_lg_ready.png");
          readTextFile("cups.json", function(text){
            var data = JSON.parse(text);
            console.log(data);
            console.log("length :" + data.Lists.length);
            // select random cup to send
            var jsonString = JSON.stringify(obj);
            conn.send(jsonString);
          });
        } else if (name == "START") {
          obj.state = 1 // ready
          $('#lg_game_bt').text("SELECTING...");
          $('#lg_game_bt').css("font-size", 30);
          $('#lg_img').attr("src","images/icon_lg_done.png");
          $('#lg_game_bt').attr("disabled",true);
          $(".lovebutton").css("background-color", "rgba( 255, 255, 255, 0.5 )");
          $('#lg_game_bt').css("color", "#C11F61");
          readTextFile("cups.json", function(text){
            var data = JSON.parse(text);
            console.log(data);
            console.log("length :" + data.Lists.length);
            // select random cup to send
            var jsonString = JSON.stringify(obj);
            conn.send(jsonString);
          });

          setTimeout(function() {
            $('#lg_game_bt').text("READY");
            $('#lg_img').attr("src","images/icon_lg_nor.png");
            $('#lg_game_bt').attr("disabled",false);
            $(".lovebutton").css("background-color", "#C11F61");
            $('#lg_game_bt').css("color", "#FFFFFF");
            $('#lg_game_bt').css("font-size", 20);
            
          }, 5000);

        }
      };
    })
  </script>
</body>
</html>
